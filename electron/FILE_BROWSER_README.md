# Electron File Browser - Native Paths

## Overview

The Electron app's file browser displays files from the **user's home directory** instead of the web project directories:

- **C++ Files**: `~/.madola/gen_cpp/` (instead of `web/gen_cpp/`)
- **WASM Modules**: `~/.madola/trove/` (instead of `web/trove/`)

This matches where the native MADOLA executable stores generated files.

## Implementation

### IPC Handlers (main.js)

Added three IPC handlers for file browser operations:

```javascript
// List C++ files from ~/.madola/gen_cpp
ipcMain.handle('get-cpp-files', async () => { ... })

// List WASM modules from ~/.madola/trove  
ipcMain.handle('get-wasm-modules', async () => { ... })

// Get C++ file content
ipcMain.handle('get-cpp-file-content', async (event, filename) => { ... })
```

### Exposed APIs (preload.js)

```javascript
window.electronAPI = {
    isElectron: true,
    getCppFiles: () => ipcRenderer.invoke('get-cpp-files'),
    getWasmModules: () => ipcRenderer.invoke('get-wasm-modules'),
    getCppFileContent: (filename) => ipcRenderer.invoke('get-cpp-file-content', filename)
}
```

### Dual-Mode Support (app-file-browser.js)

The file browser automatically detects the environment:

```javascript
const isElectron = window.electronAPI && window.electronAPI.isElectron;

if (isElectron) {
    // Use IPC API to access ~/.madola/
    data = await window.electronAPI.getCppFiles();
} else {
    // Use fetch API to access web/gen_cpp/
    data = await fetch('/api/files/cpp');
}
```

## File Locations

### Electron (Desktop App)
```
~/.madola/
â”œâ”€â”€ gen_cpp/
â”‚   â”œâ”€â”€ calcPi.cpp
â”‚   â”œâ”€â”€ add.cpp
â”‚   â””â”€â”€ ...
â””â”€â”€ trove/
    â”œâ”€â”€ calcPi/
    â”‚   â”œâ”€â”€ calcPi.js
    â”‚   â””â”€â”€ calcPi.wasm
    â””â”€â”€ testWasm/
        â”œâ”€â”€ testSquare.js
        â””â”€â”€ testSquare.wasm
```

### Web Browser
```
web/
â”œâ”€â”€ gen_cpp/
â”‚   â”œâ”€â”€ calcPi.cpp
â”‚   â””â”€â”€ ...
â””â”€â”€ trove/
    â”œâ”€â”€ calcPi/
    â”‚   â”œâ”€â”€ calcPi.js
    â”‚   â””â”€â”€ calcPi.wasm
    â””â”€â”€ ...
```

## Usage

### For Users

1. **Run MADOLA native executable** to generate files:
   ```bash
   dist/madola.exe example.mda
   ```
   This creates files in `~/.madola/`

2. **Open Electron app**:
   ```bash
   cd electron
   npm start
   ```

3. **Click Files tab** (ðŸ“‚) in left sidebar

4. **View your files**:
   - All C++ generated by native executable
   - All WASM modules created with `@gen_addon`

### For Developers

When developing the Electron app:

```bash
# Terminal 1: Build MADOLA native executable
./dev.bat build    # Windows
./dev.sh build     # Linux/Mac

# Terminal 2: Run Electron
cd electron
npm install
npm start
```

The file browser will automatically show files from `~/.madola/` when running in Electron.

## Benefits

âœ… **Unified workspace** - Same files visible in Electron and native CLI  
âœ… **No duplication** - Single source of truth in `~/.madola/`  
âœ… **Automatic sync** - Changes immediately visible in file browser  
âœ… **Cross-platform** - Works on Windows, Mac, Linux  
âœ… **Seamless** - No configuration needed  

## Testing

1. **Generate WASM with native executable**:
   ```bash
   # Create a test file with @gen_addon
   echo "@gen_addon" > test.mda
   echo "fn test(n) { return n * 2; }" >> test.mda
   
   # Generate WASM
   dist/madola.exe test.mda
   ```

2. **Verify files created**:
   ```bash
   ls ~/.madola/gen_cpp/test.cpp
   ls ~/.madola/trove/test/test.wasm
   ```

3. **Open Electron app and check Files tab**:
   - Should see `test.cpp` in Generated C++
   - Should see `test` module in WASM Modules

4. **Click files to verify**:
   - Click `test.cpp` to view content
   - See test module with `.js` and `.wasm` files

## Future: Tauri Support

The same dual-mode design will work for Tauri:

```rust
// tauri/src/main.rs
#[tauri::command]
async fn get_cpp_files() -> Result<FileList, String> {
    let home = dirs::home_dir().unwrap();
    let gen_cpp = home.join(".madola/gen_cpp");
    // List files...
}

#[tauri::command]
async fn get_wasm_modules() -> Result<ModuleList, String> {
    let home = dirs::home_dir().unwrap();
    let trove = home.join(".madola/trove");
    // List modules...
}
```

Then update `app-file-browser.js` to check for `window.__TAURI__`.

---

*Last updated: 2025-10-22*

